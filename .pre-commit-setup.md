# Pre-commit Hooks Setup

This project uses pre-commit hooks to ensure code quality before commits.

## Initial Setup

```bash
# Install pre-commit (if not already installed)
pip install pre-commit

# Install the git hooks
pre-commit install

# Optional: Install hooks for commit messages
pre-commit install --hook-type commit-msg
```

## Usage

### Automatic (Recommended)

Once installed, pre-commit hooks run automatically on `git commit`. If any check fails, the commit is aborted and you'll see what needs to be fixed.

### Manual Run

```bash
# Run on all files
pre-commit run --all-files

# Run on staged files only
pre-commit run

# Run a specific hook
pre-commit run ruff --all-files
pre-commit run black --all-files
pre-commit run mypy --all-files
```

### Update Hooks

```bash
# Update all hooks to latest versions
pre-commit autoupdate
```

## What Gets Checked

1. **ruff**: Linting and code quality (matches CI exactly)
2. **black**: Code formatting (matches CI exactly)
3. **mypy**: Type checking (matches CI exactly)
4. **pre-commit-hooks**: Basic file checks (trailing whitespace, file endings, etc.)

## Version Pinning

All tool versions are pinned to ensure consistency between local development and CI:

- `ruff`: 0.6.x (supports modern configuration format)
- `black`: 24.3.x
- `mypy`: 1.9.x

These versions are compatible with the CI environment and provide the best balance of features and stability.

## Troubleshooting

### Skip hooks temporarily

```bash
# Skip all hooks for one commit (not recommended)
git commit --no-verify

# Skip specific hooks (e.g., when committing work-in-progress)
SKIP=mypy git commit
```

**When to skip hooks:**
- `SKIP=mypy` - When committing code with type issues to fix later
- Never skip linting (black, ruff) - these are fast and keep code clean

### Clear cache

```bash
pre-commit clean
```

### Reinstall hooks

```bash
pre-commit uninstall
pre-commit install
```

## Why pytest is NOT in pre-commit

Tests are **intentionally not included** in pre-commit hooks for these reasons:

1. **Environment dependency** - Tests require the package to be installed (`pip install -e .`)
2. **Speed** - Tests take 1-2 seconds, which can slow down rapid commits
3. **CI coverage** - GitHub Actions already runs all tests on every push
4. **Flexibility** - Developers can commit WIP code and fix tests later

### Run tests manually

```bash
# Run all tests
pytest tests/ -v

# Run with coverage
pytest tests/ -v --cov=src/dlzoom --cov-report=term

# Run specific test file
pytest tests/test_zoom_client.py -v
```

### Optional: Add pytest to pre-commit (advanced)

If you want pytest in pre-commit (requires `pip install -e ".[dev]"` first):

Add to `.pre-commit-config.yaml`:

```yaml
  - repo: local
    hooks:
      - id: pytest
        name: pytest
        entry: bash -c 'pytest tests/ -v --tb=short'
        language: system
        pass_filenames: false
        always_run: true
```
